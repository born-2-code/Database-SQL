/* ************************************************************************** */
/*                                                                            */
/*   QUERIES.SQL                       $$$$$$$$\ $$\   $$\ $$$$$$\  $$$$$$\   */
/*                                     $$  _____|$$ |  $$ |\_$$  _|$$  __$$ | */
/*                                     $$ |      \$$\ $$  |  $$ |  $$ /  $$ | */
/*                                     $$$$$\     \$$$$  /   $$ |  $$$$$$$$ | */
/*   By:        		               $$  __|    $$  $$<    $$ |  $$  __$$ | */
/*                                     $$ |      $$  /\$$\   $$ |  $$ |  $$ | */
/*   Erwan PLESSIS                     $$$$$$$$\ $$ /  $$ |$$$$$$\ $$ |  $$ | */
/*                                     \________|\__|  \__|\______|\__|  \__| */
/*                                                                            */
/* ************************************************************************** */

#------------------------------------------------------------------------------------------------------------------------
#                                                 Requêtes SQL
#------------------------------------------------------------------------------------------------------------------------

#------------------------------------------------------------------------------------------------------------------------
#             1 - Le nombre total de minutes passées sur le terrain par un joueur (équivalent en heures voire jours)
#------------------------------------------------------------------------------------------------------------------------

SELECT SUM(Jouer.tmps_jeu_j) AS tmps_jeu_min, (SUM(Jouer.tmps_jeu_j)/60) AS tmps_jeu_heur FROM Jouer
WHERE no_j = '1';

#------------------------------------------------------------------------------------------------------------------------
#                                     2 - Le nombre de matchs joués par un joueur
#------------------------------------------------------------------------------------------------------------------------

SELECT Jouer.no_j, COUNT(Jouer.tmps_jeu_j) AS nbr_match_joue FROM Jouer
WHERE no_j = '3';

#------------------------------------------------------------------------------------------------------------------------
#                                3 - Le nombre total de buts marqués par un joueur
#------------------------------------------------------------------------------------------------------------------------

SELECT COUNT(no_j) FROM But WHERE no_j = '10' UNION SELECT nom_j From Joueur 
WHERE nom_j = 'Ibrahimovic';

#------------------------------------------------------------------------------------------------------------------------
#                                4 - Le temps moyen de présences des joueurs sur le terrain
#------------------------------------------------------------------------------------------------------------------------

SELECT AVG(Jouer.tmps_jeu_j) AS tmps_tot_jeu_moy FROM Jouer;

#------------------------------------------------------------------------------------------------------------------------
#                     5 - Le nombre total de buts marqués par l’équipe
#------------------------------------------------------------------------------------------------------------------------

SELECT SUM(score_equipe) FROM `Matchh`;

#------------------------------------------------------------------------------------------------------------------------
#                     6 - Le nombre de cartons obtenus (jaunes et rouges) par un joueur, par l’équipe
#------------------------------------------------------------------------------------------------------------------------

# Par joueur

SELECT COUNT(*) FROM Faute 
WHERE no_j = '14';

# Par équipe 

SELECT COUNT(no_j) FROM Faute
WHERE no_j BETWEEN 1 AND 44 ;

#------------------------------------------------------------------------------------------------------------------------
#              7 - Le nombre de matchs gagnés par l’équipe par rapport au nombre de matchs joués (pourcentage)
#------------------------------------------------------------------------------------------------------------------------

SELECT Gagnant, COUNT(Gagnant = 'equipe') * 100 / (SELECT COUNT(id_mat) FROM Matchh) FROM Matchh
GROUP BY Gagnant;

#------------------------------------------------------------------------------------------------------------------------
#                     8 - Le nombre de matchs arbitrés par un arbitre donné (principal ou assistant)
#------------------------------------------------------------------------------------------------------------------------

SELECT COUNT(*) FROM `Arbitrage` 
WHERE `nom_arbitre_princ` = 'Husmann' 
OR `nom_arbitre_assist_1` = 'Husmann' 
OR `nom_arbitre_assist_2` = 'Husmann';

#------------------------------------------------------------------------------------------------------------------------
#                     9 - La combinaison d’avants/ailiers la plus efficace	
#------------------------------------------------------------------------------------------------------------------------

SELECT no_j, COUNT(*) FROM(SELECT poste_j_pdt_match, no_j FROM Jouer NATURAL JOIN But) as jointure
WHERE (no_j BETWEEN 1 AND 44) AND ((poste_j_pdt_match = 'Attaquant') OR (poste_j_pdt_match = 'Milieu') OR (poste_j_pdt_match = 'Milieu offensif'))
GROUP BY no_j
ORDER BY COUNT(*) DESC
LIMIT 3;
